# Домашнее задание №2 Технопарк курс "Проектирование высоконагруженных приложений"
[Общее задание](https://park.mail.ru/blog/topic/view/15123/)


 Выбранная тема - Сервис онлайн прослушивания музыки (like Яндекс.Музыка, BOOM, Spotify)

 -----

1. [Определение возможного диапазона нагрузок проекта](#Определение-возможного-диапазона-нагрузок-проекта)
    * [Оценка аудитории](#Оценка-аудитории)
    * [Оценка нагрузки](#Оценка-нагрузки)
2. [Выбор планируемой нагрузки]()
3. [Логическая схема базы данных]()
4. [Физическая системы хранения]()
5. [Выбор прочих технологий]()
6. [Расчет нагрузки и потребного оборудования]()
7. [Выбор хостинга / облачного провайдера и расположения серверов]()
8. [Схема балансировки нагрузки]()
9. [Обеспечение отказоустойчивости]()

## Определение возможного диапазона нагрузок проекта

### Оценка аудитории 
 По данным [Яндекс.Радар](https://radar.yandex.ru/) месячная аудитория Яндекс.Музыки за октябрь составила ~12.5 млн человек, при дневной аудитории в ~2.1 млн человек<sup>[[1]](https://radar.yandex.ru/yandex?month=2020-10)</sup>. Среднее время проведенное пользователем в месяц с учетом кросс-платформенности составляет 7 часов 6 минут.

### Оценка нагрузки

Оценка показателей нагрузки произовдилась на примере [Яндекс.Музыки](https://music.yandex.ru/). Основная нагрузка в сервисе приходится на отправку аудио файлов пользователю. Как среднюю длину одного трека возьмем 4 минуты 10 секунд. *(Данные получены на основе анализа медиатеки автора - плейлист в 1905 треков продолжительностью 132.5 часа)* Размер секунды аудиозаписи при битрейте в 192 Кбит/с составляет 24 Кб. Следовательно средний размер аудиозаписи в стандартном качестве *(в сервисе присутствует воспроизведение музыки в высоком качестве)* в сервисе составляет:

`Размер_трека = (4 мин * 60 с + 10 с) * 24 Кб = 6000 Кб ~= 5.86 Мб`

Объем медиатеки сервиса на момент 27 сентября 2017 года составлял более 35 млн треков <sup>[[2]](https://www.interfax.ru/business/580802)</sup>. Хранение 35 млн треков требует как минимум:

`Минимальный_объем_памяти_медиатеки = 35 * 10^6 * 5.86 ~= 205 100 000 Мб ~= 195.6 Тб`

По данным [speedtest.net global index](https://www.speedtest.net/global-index) средняя скорость интернета на загрузку в России для Wi-Fi станций (что можно считать средней скоростью домашнего интернета) составляет 77.51 Мбит/с, для мобильного интернета - 23.22 Мбит/с. Доля мобильной аудитории Яндекс.Музыки согласно данным Яндекс.Радара составляет 39%. Однако мобильными пользователями можно пренебречь, т.к. мобильное приложение позволяет сохранять треки на своем устройстве. В итоге интернет-соединение для мобильного пользователя требуется только для прослушивания не сохраненных треков и для сбора статистики по прослушиванию. Возьмем среднюю скорость загрузки равной 77.51 Мбит/с

По этим данным получаем, что для загрузки 1 трека в Яндекс.Музыке необходимо:

`Время_загрузки = 5.86 Мб / (77.51 Мбит/с / 8 бит) ~= 0.6 сек`

Среднее время прослушивания музыки в день у пользователей Яндекс.Музыки составляет 90 минут<sup>[[3]](https://rg.ru/2020/03/26/kakuiu-muzyku-predpochitaiut-slushat-rossiiane-na-karantine.html)</sup> (5400 секунд). При средней длине трека в 250 секунд, получим среднее количество прослушиваемых треков в день равное 22 трекам. Как было замечено выше у мобильных пользователей потребность в загрузке треков минимальна, поэтому мы можем пренебречь этими данными в следующих расчетах. Тогда дневная аудитория активно нагружающая сервис будет составлять ~1.28 млн человек. Среднее количество запросов в секунду будет составлять: 

`RPS_загрузка_трека = 1.28 * 10^6 чел * 22 трека / (24 ч * 60 мин * 60 с) = 326 rps`

При этом размер трафика будет составлять:

`Трафик_загрузки_трека = 1.28 * 10^6 чел * 22 трека * 5.86 Мб * 8 бит / (24 ч * 60 мин * 60 с) ~= 14.92 Гбит/с`

<!-- В качестве предполагаемой нагрузки выбрано значение в 30% от общей доли интернет-пользователей в России. По данным проекта [Web-Index](https://webindex.mediascope.net/) сайта [Mediascope](https://mediascope.net/) количество интернет-пользователей старше 12 лет в России составляет ~95.3 млн человек<sup>[[2]](https://webindex.mediascope.net/general-audience)</sup>. -->
